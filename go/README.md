
# nebula-go

  
Official Nebula Go client which communicates with the server using [fbthrift](https://github.com/facebook/fbthrift/).

  

Please be careful do not to modify the files in the graph directory, these codes were all generated by fbthrift.

  

## Install

  

```shell

$ go get -u -v github.com/vesoft-inc/nebula-clients/go@master

```

  

If you get a message like `cannot use path@version syntax in GOPATH mode`, see the instructions below for [enabling go modules](#enabling-go-modules).

  

## Usage example

  

```go

package main

import (
	"fmt"
	"strconv"
	"sync"
	"time"

	"github.com/vesoft-inc/nebula-clients/go/nebula/pkg/conf"
	"github.com/vesoft-inc/nebula-clients/go/nebula/pkg/data"
	"github.com/vesoft-inc/nebula-clients/go/nebula/pkg/logger"
	"github.com/vesoft-inc/nebula-clients/go/nebula/graph"
	nebulaNet "github.com/vesoft-inc/nebula-clients/go/nebula/pkg/net"
)

const (
	address  = "127.0.0.1"
	port     = 3699
	username = "user"
	password = "password"
)

// Initialize logger
var log = *new(logger.DefaultLogger)

func main() {
	// Create host object
	hostAdress := data.HostAddress{Host: address, Port: port}
	hostList := []data.HostAddress{
		hostAdress,
	}
	// Create configs for connection pool using default values
	testPoolConfig := conf.GetDefaultConf(log)
	// Initialize connectin pool
	pool := nebulaNet.ConnectionPool{}
	err := pool.InitPool(hostList, testPoolConfig, log)
	if err != nil {
		log.Fatal(fmt.Sprintf("Fail to initialize the connection pool, host: %s, port: %d, %s", address, port, err.Error()))
	}
	// Close all connections in the pool
	defer pool.Close()

	// Create session and send query in go routine
	var wg sync.WaitGroup
	wg.Add(1)
	go func(wg *sync.WaitGroup) {
		defer wg.Done()
		// Create session
		session, err := pool.GetSession(username, password)
		if err != nil {
			log.Fatal(fmt.Sprintf("Fail to create a new session from connection pool, username: %s, password: %s, %s",
				username, password, err.Error()))
		}
		// Release session and return connection back to connection pool
		defer session.Release()
		
		// Method used to check execution response
		checkResp := func(prefix string, err *graph.ExecutionResponse) {
			if nebulaNet.IsError(err) {
				fmt.Printf("%s, ErrorCode: %v, ErrorMsg: %s", prefix, err.GetErrorCode(), err.GetErrorMsg())
			}
		}
		{
			createSchema := "CREATE SPACE IF NOT EXISTS test; " +
				"USE test;" +
				"CREATE TAG IF NOT EXISTS person(name string, age int);" +
				"CREATE EDGE IF NOT EXISTS like(likeness double)"

			// Excute a query
			resp, err := session.Execute(createSchema)
			if err != nil {
				fmt.Printf(err.Error())
				return
			}
			checkResp(createSchema, resp)
		}
		time.Sleep(5 * time.Second)
		{
			insertVertexes := "INSERT VERTEX person(name, age) VALUES " +
				"'Bob':('Bob', 10), " +
				"'Lily':('Lily', 9), " +
				"'Tom':('Tom', 10), " +
				"'Jerry':('Jerry', 13), " +
				"'John':('John', 11);"

			// Insert multiple vertexes
			resp, err := session.Execute(insertVertexes)
			if err != nil {
				fmt.Printf(err.Error())
				return
			}
			checkResp(insertVertexes, resp)
		}

		{
			// Insert multiple edges
			insertEdges := "INSERT EDGE like(likeness) VALUES " +
				"'Bob'->'Lily':(80.0), " +
				"'Bob'->'Tom':(70.0), " +
				"'Lily'->'Jerry':(84.0), " +
				"'Tom'->'Jerry':(68.3), " +
				"'Bob'->'John':(97.2);"

			resp, err := session.Execute(insertEdges)
			if err != nil {
				fmt.Printf(err.Error())
				return
			}
			checkResp(insertEdges, resp)
		}

		{
			query := "GO FROM 'Bob' OVER like YIELD $^.person.name, $^.person.age, like.likeness"
			// Send query
			resp, err := session.Execute(query)
			if err != nil {
				fmt.Printf(err.Error())
				return
			}
			checkResp(query, resp)
			printResult(resp)
		}
	}(&wg)

	wg.Wait()

	log.Info("Example finished")
}
  
```

  

## Enabling go modules

  

Dependency management tools are built into go 1.11+ in the form of [go modules](https://github.com/golang/go/wiki/Modules).

If you are using go 1.11 or 1.12 and are working with a project located within `$GOPATH`, you need to do:

  

```sh

export GO111MODULE=on

```

  

Ensure your project has a `go.mod` file defined at the root of your project.

If you do not already have one, `go mod init` will create one for you:

  

```sh

go mod init

```

  

And then try to get dependencies of `github.com/vesoft-inc/nebula-clients/go` in your go module by simply `go get -u -v github.com/vesoft-inc/nebula-clients/go@master`.
