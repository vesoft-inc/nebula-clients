
# nebula-go

  
Official Nebula Go client which communicates with the server using [fbthrift](https://github.com/facebook/fbthrift/).

  

Please be careful do not to modify the files in the graph directory, these codes were all generated by fbthrift.

  

## Install

  

```shell

$ go get -u -v github.com/vesoft-inc/nebula-clients/go@master

```

  

If you get a message like `cannot use path@version syntax in GOPATH mode`, see the instructions below for [enabling go modules](#enabling-go-modules).

  

## Usage example

  

```go

package main

import (
	"fmt"

	"github.com/vesoft-inc/nebula-clients/go/nebula/graph"
	conf "github.com/vesoft-inc/nebula-clients/go/src/conf"
	data "github.com/vesoft-inc/nebula-clients/go/src/data"
	nebulaNet "github.com/vesoft-inc/nebula-clients/go/src/net"
)

const (
	address  = "127.0.0.1"
	port     = 3699
	username = "user"
	password = "password"
)

func main() {
	hostAdress := data.HostAddress{Host: address, Port: port}
	hostList := []data.HostAddress{
		hostAdress,
	}
	pool := nebulaNet.ConnectionPool{}

	// Create configs for connection pool using default values
	testPoolConfig := conf.GetDefaultConf()
	// Initialize connectin pool
	err := pool.InitPool(hostList, testPoolConfig)
	if err != nil {
		fmt.Printf("Fail to initialize the connection pool, host: %s, port: %d, %s", address, port, err.Error())
	}
	// Create session
	session, err := pool.GetSession(username, password)
	if err != nil {
		fmt.Printf("Fail to create a new session from connection pool, username: %s, password: %s, %s",
			username, password, err.Error())
	}
	// Method used to check execution response
	checkResp := func(prefix string, err *graph.ExecutionResponse) {
		if nebulaNet.IsError(err) {
			fmt.Printf("%s, ErrorCode: %v, ErrorMsg: %s", prefix, err.GetErrorCode(), err.GetErrorMsg())
		}
	}
	// Excute a query
	resp, err := session.Execute("SHOW HOSTS;")
	if err != nil {
		fmt.Printf(err.Error())
		return
	}
	checkResp("show hosts", resp)

	defer func(){
		// Release session and return connection back to connection pool
		session.Release()
		// Close all connections in the pool
		pool.Close()
	}()
	
}
  
```

  

## Enabling go modules

  

Dependency management tools are built into go 1.11+ in the form of [go modules](https://github.com/golang/go/wiki/Modules).

If you are using go 1.11 or 1.12 and are working with a project located within `$GOPATH`, you need to do:

  

```sh

export GO111MODULE=on

```

  

Ensure your project has a `go.mod` file defined at the root of your project.

If you do not already have one, `go mod init` will create one for you:

  

```sh

go mod init

```

  

And then try to get dependencies of `github.com/vesoft-inc/nebula-clients/go` in your go module by simply `go get -u -v github.com/vesoft-inc/nebula-clients/go@master`.
